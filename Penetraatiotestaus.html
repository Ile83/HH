<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Penetraatiotestaus</title>
<style type="text/css">
   
    body, html
            {
                max-width: 47em;
            }
    body,td,th {
        font-family: "Myriad Pro", "Myriad Pro Bold", Garamond;
    }
    </style>
</head>

<body>
    <h1>Haaga-Helia ammattikorkeakoulu
        </h1>
        <h2>
        Penetraatiotestaus
        </h2>
    <br>
    23.10.2023
    <br>
    <h3>h0 Alkuluento</h3>

    <img src="Graphics/Penetraatiotestaus/1.png" alt="" width="700" height=""/>
    <p>
        200 koodi tarkoittaa, että pyyntö hyväksyttiin
        <br>
        301 pyydetty osoite on muutettu pusyvästi ja uusi osoite on annettu vastautaksessa
        <br>
        jokaisessa käytettiin GET metodia
        <br>
        Domain: osoite mistä haetaan tai palautetaan tieto
        <br>
        File: tiedosto joka kyseessä
        <br>
        Lähde: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#successful_responses
</p>
<img src="Graphics/Penetraatiotestaus/2.png" alt="" width="700" height=""/>
<p>
Initiator en tiedä tarkalleen, arvioisin, että kyseessä on alkuperäinen tiedosto, josta lähti haku
Yritin selvittää lähteestä mutta, en ehtinyt. Lähde: https://firefox-source-docs.mozilla.org/devtools-user/network_monitor/request_details/index.html
</p>
<img src="Graphics/Penetraatiotestaus/3.png" alt="" width="700" height=""/>
<p>
    Esimerkkinä vielä wiresharkin index.php get metodin koodilla 200 tieto mitä tulee palautuksena
</p>
<h1>Haaga-Helia ammattikorkeakoulu
</h1>
<h2>
Penetraatiotestaus
</h2>
<br>
25.10.2023
<br>
<h3 id="Luento1">h1 Hacker Warmup</h3>
    <h3>X) Lue ja tiivistä: € Santos et al: The Art of Hacking (Video Collection): [..] 4.3 Surveying Essential Tools for Active Reconnaissance. Sisältää porttiskannauksen. 5 videota, yhteensä noin 20 min.</h3>
    <li>- Käytiin läpi eri porttiskannereita Nmap suosituin ja vakain.</li>
    <li>- Eyewitness sovellus, joka luo tiedoston kuvakaappauksin saitista.</li>
    <li>- eri verkkohaavoittuvuus skannereita, maksullisia ja open source</li>
    <li>- eri nettihaavoittuvuus skannereita</li>
    <h3>Hutchins et al 2011: Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains, chapters Abstract, 3.2 Intrusion Kill Chain.</h3>
    <li>- voidaan kerätä tietoa hyökkäyksistä ja rakentaa sitä vastaan suojaa, että hyökkäykset eivät onnistu</li>
    <li>- Advanced persistent threat APT</li>
    <li>- kohteena intellectual property, eli immateriaalisen oikeuden takana olevat asiat, arkaluontoinen data</li>
    <li>- hyökkääjät hyödyntävät muokattua maltsua ja nollapäivä haavoittuvuuksia</li>
    <li>- Tunkeutuminen voidaan keskeyttää intteligence driven responsella, eli vastataan siihen omaan tiedusteluun perustuen</li>
    <li>- Tappoketju on systemaattinen prosessi, joka kohdennetaan ja suoritetaan saavuttaakseen halutun lopputuloksen.</li>
    <li>- Hyväksikäyttö kohdistuu ohjelmaan, käyttöjärjestelmän haavoittuvuuteen, työntekijän hyväksikäyttöön tai ominaisuuteen, joka automattisesti käynnistää koodin pätkän</li>
    <li>- Jos vastustajat pystyvät havaitsemaan hyökkäyksen ajoissa ja suojaamaan järjestelmää, he säilyttävät taktisen edun</li>
    <li>- Hyökkäyksen tarkoituksen, kyvykkyyden, doktriinin ja operaatio muotojen ymmärtäminen on tarpeen, jotta voidaan muodostaa vastustuskyky hyökkäykseen</li>
    <h3>a) Ratkaise Over The Wire: Bandit kolme ensimmäistä tasoa (0-2).</h3>
    <img src="Graphics/Penetraatiotestaus/4.png" alt="" width="700" height=""/>
<p>Pääsin sisään. Lähde: ssh --help komento</p>
<img src="Graphics/Penetraatiotestaus/5.png" alt="" width="700" height=""/>
<p>
Löysin salasanan. Lähde: <a href="https://man7.org/linux/man-pages/man1/cat.1.html">Man pages</a>
</p>
<img src="Graphics/Penetraatiotestaus/6.png" alt="" width="700" height=""/>
<p>
    Lähde: <a href="https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal">Stack Overflow</a>
</p>
<img src="Graphics/Penetraatiotestaus/7.png" alt="" width="700" height=""/>
<p>
    kokeilin cat komentoa ja bash autocompletionia ja sillä onnistui
</p>    
<h3>b) Ratkaise Challenge.fi:stä yksi tehtävä, esim. Challenge.fi 2021 Where was this picture taken, Encoding basics. Tai joku Challenge.fi 2022. (Nimi vaihtui sattuneesta syystä, se on nykyisin Next Gen Hack Challenge)</h3>
<img src="Graphics/Penetraatiotestaus/8.png" alt="" width="700" height=""/>
<p>Valitsin Encoding basics. Tajusin, että se on Base64 formaatissa ja hain base64decode.orgin googlella ja kokeilin. En käyttänyt yhtään vihjettä. Flagi ratkesi heti</p>
<h3>c) Ratkaise PortSwigger Labs: Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data. (Edellyttää ilmaista rekisteröitymistä. Tehtävän voi ratkaista pelkästään selaimen osoitekenttää muokkaamalla.)</h3>
<img src="Graphics/Penetraatiotestaus/9.png" alt="" width="700" height=""/>
<p>Muokkasin osoitekenttää, tajusin suurinpiirtein mitä tein, mutta tälle on varmasti hienompi tapa ja toteutus. En olisi itse keksinyt injektion koodia, ellei se olisi lukenut labissä</p>
<h3>d) Asenna Linux virtuaalikoneeseen. Suosittelen joko Kali (viimeisin versio) tai Debian 12-Bookworm.</h3>
<p>
    Päätin käyttää melkein puhdasta konetta, jonka olin asentanut aikaisemmin Linux kurssin koetta varten, Apache ainakin on siinä valmiina asennettuna.
<br>
Kali linuxin olin myös asentanut jo aiemmin, siinä olen ajanut sudo apt-get update ja upgrade komennot, vastaan tuli kyllä sen verta kryptistä asiaa, että en ole varma olisiko kannattanut käyttää upgrade komentoa. Ei ollut aikaa perehtyä ilmoituksiin joita tuli asennuksen aikana.
</p>
<h3>f) Porttiskannaa kaikki koneesi (localhost) tcp-portit. Analysoi tulokset. (Edellisissä kohdissa mainittuja analyyseja ei tarvitse toistaa, voit vain viitata niihin ja keskittyä eroihin).</h3>
<img src="Graphics/Penetraatiotestaus/10.png" alt="" width="700" height=""/>
<p>
Asensin porttiskanneri nmapin ja skannasin localhostin, näkyy kellonaika, joka on GMT 0 ajassa, en tiedä mitä BST tarkoittaa mutta kello on kaksituntia jäljessä. Olen asentanut virtuaalikoneen ollessani Lontoossa, en tiedä onko tällä vaikutusta käyttöjärjestelmän kelloon. Tarkstelen sitä myöhemmin.
<br>
Local hostosoitteessa 127.0.0.1 latenssi oli 0.00063s, eli kone on todella lähellä. Ja niin on syytäkin olla koska se on vieressäni, eikä välissä ole esim valokaapelia. latenssista voi hieman päätellä kuinka pitkällä kone sijaitsee.
<br>
Ilmeisesti yksi portti ei skannautunut kohdassa Other addresses for localhost (not scanned)
<br>
Listassa ei näytetä kiinni olevia portteja 997 kpl niihin ei saatu yhteyttä.
portti 25/tcp, 80/tcp, 631/tcp ovat auki. Ensimmäinen viittaa sähköpostin lähetys palvelimeen, seuraava verkkosivuihin ja viimeinen on internet printing protokollan portti 
</p>
<h3>g) Tee laaja porttiskanaus (nmap -A) omalle koneellesi (localhost), kaikki portit. Selitä, mitä -A tekee. Analysoi tulokset. (Edellisissä kohdissa mainittuja analyyseja ei tarvitse toistaa, voit vain viitata niihin ja keskittyä eroihin.).</h3>
<img src="Graphics/Penetraatiotestaus/11.png" alt="" width="700" height=""/>
<li>Portti 25 ssl certifikaatti näyttäisi paljastavan, että käytössä on Debian käyttöjärjestelmä, en tiedä mitä organizationName=Exim tarkoittaa? Sitten taas viitataan UK:hon, saattaa johtua, että asensensin virtuaalikoneeni ollessani lontoossa.</li>
<li>Sertifikaattion alkamis ja loppumis pvm. ja kellonajat. tosin en ihan ymmärrä noita vuosia ja päiviä.</li>
<li>Ssl-date TLS randomness does not represent time, selittääkö tämä sitten tuon ylemmän.</li>
<li>80 portissa pyörii Apache palvelin versio numerolla 2.4.57 ja Debian käytttöjärjestelmällä näyttäen default sivua ja se toimii tekstillä</li>
<li>631 portissa pyörii palvelu CUPS 2.4 liittyy siis tulostamiseen, en osaa muuta sanoa. Luulisin, että tuo robots.txt on suojattu ja siihen ei päässyt käsiksi</li>
<li>Yksi ip osite skannatiin ja siihen kului 8.81 sekuntia.</li>
<h3>h) Asenna ja käynnistä jokin palvelin (apache, ssh...) koneellesi. Vertaile, miten porttiskannauksen tulos eroaa.</h3>
<p>
Minulla näköäjään oli koneella jo apache pyörimässä, joten suljin sen tätä tehtävää varten komennolla ”sudo systemctl stop apache2”
<br>
sitten tein uudestaan laaja porttiskannauksen
</p>
<img src="Graphics/Penetraatiotestaus/12.png" alt="" width="700" height=""/>
<p>
    Nyt portti 80 ei näy skannatuissa porteissa, kun siinä ei siis pyöri enää palvelinta.
</p>
<h3>i) Kokeile ja esittele jokin avointen lähteiden tiedusteluun sopiva weppisivu tai työkalu. Hyviä esimerkkejä löytyy Bazzel: IntelTechniques: Tools ja Bellingcat: Resources, voit myös käyttää muuta itse valitsemaasi työkalua. Työkalua pitää siis myös kokeilla, pelkkä nimen mainitseminen ei riitä. Pidä esimerkit harmittomina, älä julkaise kenenkään henkilökohtaisia salaisuuksia raportissasi.</h3>
<img src="Graphics/Penetraatiotestaus/13.png" alt="" width="700" height=""/>
<p>
    Laitoin kuvan, jonka otin tuosta lähteen artikkelista, ja laitoin sen Bingiin. Tuloksena oli kuvalle väärät koordinaati, mutta eri kuin mitä Bellincatin artikkelin kirjoittaja oli saanut. Ei näihin kyllä vielä ole luottamista.
<br>
Lähde: <a href="https://www.bellingcat.com/resources/2023/07/14/can-ai-chatbots-be-used-for-geolocation/">Bellingcat Geolocation</a>
</p>
<p>
Raportin lähteenä on käytetty: <a href="https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h1-hacker-warmup">Terokarvinen.com</a>
</p>
<h1>Haaga-Helia ammattikorkeakoulu
</h1>
<h2>
Penetraatiotestaus
</h2>
<br>
04.11.2023
<br>
<h3 id="Luento2">h2 Sniff-n-scan</h3>
<p>
    tutustuttaa uuteen lähteeseen, hakkeritapahtumien nauhoihin. Opit valvomaan hyökkäystyökalujen toimintaa snifferillä, ja tutustut Wiresharkiin. Wireshark osaa myös analysoida paketit automaattisesti. Weppiin murtautumista auttaa suomalainen, fuzzereiden huipulle noussut ffuf. Harjoitusmaalien asentamisesta kokeillaan paikallisia binäärejä (by yours truly) ja Dockeria.
</p>
<h4>x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)   
</h4>
<h4>Hoikkala "joohoi" 2020: <a href="https://www.youtube.com/watch?v=mbmsT3AhwWU"> Fuzzing Faster (U fool).</a> In HelSec Virtual meetup #1. (about 1 hour)</h4>
<li>Joona Hoikkala</li>
<li>Burbsuiten voi yhistää</li>
<li>FUZZ on tärkeä komennossa</li>
<li>Useita ominaisuuksia</li>
<h4>Lyon 2009: Nmap Network Scanning: Chapter 15. Nmap Reference Guide:
    <a href="https://nmap.org/book/man-port-scanning-basics.html">PortScanning Basics</a>(opettele, mitä tarkoittavat: open, closed, filtered; muuten vain silmäily)
    </h4>
    <li>- Open: avoin portti, näitä hyökkääjät etsivät, tapa päästä sisään. Adminien kannattaisi sulkea tai turvata tulimuurilla. Näistä saa myös selville mitkä palvelut ovat auki verkkoon.</li>
    <li>- Closed: portti on käytettävissä mutta siinä ei pyöri mikään sovellus, joka kuuntelee. Voi olla hyödyllinen toteamaan, että isäntä kone on ylhäällä. kannattaa mahdollisesti skannata uudelleen, jos vaikka porttiin ilmaantuisi jotain kuuntelemaan.</li>
    <li>- Filtered: Nmap ei osaa päätellä onko portti auki vai kiinni erilaisten syiden takia. filtered porteista ei saa paljon tietoa, hidastaa skannausta todella paljon.</li>
<h4><a href="https://nmap.org/book/man-port-scanning-techniques.html">Port Scanning Techniques </a> (opettele, mitä ovat: -sS -sT -sU; muuten vain silmäily.</h4>
<li>- sS (TCP SYN scan): perusskannaus, skannaa tuhansia portteja sekunneissa, ei tunkeutuva ja hyvin suojassa pysyvä skannaus. Ei muodosta valmiita TCP yhteyksiä. ns. puolijulkinen skannaus. Jakaa skannaukset selkeästi open, closed ja filtered tiloihin.TCP, SYN paketti odotus, A SYN/ACK, RST</li>
<li>- sT (TCP connect scan): Käytetään perusskannauksena, kun TCP SYN scan ei käy kyseeseen. Johtuu siitä, jos käyttäjällä ei ole rakaa pakettidata oikeuksia (Sudo?) SYN scan on useimmiten parempi vaihtoehto, jos sitä voi käyttää. Connect scan luo TCP yhteyden ja todennäköisemmin jättää jäljen lokiin.</li>
<li>- sU (UDP scans): UDP Skannaus, UDP palvelut joita pyöritetään. DNS, SNMP, and DHCP (rekisteröidyt portit 53, 161/162, ja 67/68) ovat yleisimmät. Porttiskannus hidasta, kaikkien porttien skannaus voi viedä jopa 18 tuntia, kanttaa usein skannata tavanomaisimmat portit ja pyörittää useita skannauksia rinnakkain. Portit ovat erinomaisia tunkeutujille, koska tietoturvasta vastaavat jättävät usein portit huomioimatta. Voidaan yhdistää SYN skannaukseen samanaikaisesti.</li>
<h4>a) Fuff. Ratkaise <a href="https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/?fromSearch=ffuf#your-turn---challenge">Teron ffuf-haastebinääri.</a> Artikkelista <a href="https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/">Find Hidden Web Directories - Fuzz URLs with ffuf</a>voi olla apua.</h4>
<img src="Graphics/Penetraatiotestaus/14.png" alt="" width="700" height=""/>
<p>komento “sudo apt-install wget” 
    <br>
    komento” wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-1”
    </p>
    <img src="Graphics/Penetraatiotestaus/15.png" alt="" width="700" height=""/>
    <p>komento “chmod u+x dirfuzt-1”, harjoitusmaalin käynnistys ”./dirfuzt-1”, ja avaus Firefoxilla, harjoitusmaali on käynnissä.
        <br>
        hain wgetillä fuzzin teron ohjeiden mukaan ja latasin common.txt
        <br>
        ”./ffuf -w common.txt -u http:/127.0.0.2:8000/FUZZ”
        </p>
        <img src="Graphics/Penetraatiotestaus/16.png" alt="" width="700" height=""/>
    <p>
        Harjoitusmaali oli alhaalla, nostin sen pystyyn komennolla ”./dirfuz-1” ja kokeilen uudestaan.
    </p>
    <img src="Graphics/Penetraatiotestaus/17.png" alt="" width="700" height=""/>
    <p>Onnistui, mutta pitäisi filtteröidä</p>
    <img src="Graphics/Penetraatiotestaus/18.png" alt="" width="700" height=""/>
    <p>komento ” ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 154”
        palautti tämän nälkoisen tulosteen, tässä näkyy kaikki mikä jäi filteröinnin jälkeen, fillteröin siis tiedosto koon mukaan (154 tavuiset tiedostot pois tuloksista). Ja onhan siellä wordressiin admin, kävin selaimella osoitteessa ja lippu löytyi.
        </p>
<h4>b) Fuffme. Asenna Ffufme harjoitusmaali paikallisesti omalle koneellesi. Ratkaise tehtävät (kaikki paitsi ei "Content Discovery - Pipes")</h4>
<p>
- Valitetavasti en tajunnut tehdä tätä. En ymmärtänyt, että ffufme oli linkki, koska olin kopioinut tehtävän tekstieditoriin.
</p>
        <h4>
            Porttiskannaa paikallinen kone (127.0.0.2 tms), sieppaa liikenne snifferillä, analysoi.
            En löydä Wiresharkin tiedoista oikeita paketteja ☹
        </h4>
            <h4>c) nmap TCP connect scan -sT</h4>
            <img src="Graphics/Penetraatiotestaus/19.png" alt="" width="700" height=""/>
<p>
    Komento ”nmap -sT 127.0.0.2”
    <br>
En saanut wiresharkilla skannattua liikennettä tuosta. Se näyttää kyllä verkossa olevaa muuta liikennettä. Minulla on virtuaalikoneesta katkaistu nettiyhteys. En kyllä ymmärrä miten Wireshark näyttää muuta verkkoliikennettä silti. Idea connected scannissa on, että se luo kuitenkin TCP yhteyden ja on näin ollen helpommin havaittavissa lokista.
<br>
Yhtään porttia ei ole koneessa auki.
<br>
Jatkan tehtävien tekoa ilman Wiresharkkia, en tiedä missä siinä on vika. Dataa tulee paljon, mutta en löydä sieltä oikee, voi toki olla user error 😊
</p>
<h4>d) nmap TCP SYN "used to be stealth" scan, -sS (tätä käytetään skannatessa useimmin)</h4>
<img src="Graphics/Penetraatiotestaus/20.png" alt="" width="700" height=""/>
<p>
    komento ”nmap -sS locahost” tarvitsee Super user do oikeudet, niin kuin arvelinkin aikaisemmassa tehtävässä. Kokeilen sudolla.
</p>
<img src="Graphics/Penetraatiotestaus/21.png" alt="" width="700" height=""/>
<p>
    komento ”sudo nmap -sS 127.0.0.2”
    <br>
    komenonnon ero on se, että tätä ei pysty niin helposti havaitsemaan, kun tämä ei muodosta täyttä TCP yhteyttä vaan droppaa yhteyden havaitessaan, jos portti vastaa. Ei jätä lokiin jälkeä. En saanut tätäkään Wiresharkilla kaapattua.
</p>
<h4>e) nmap ping sweep -sn</h4>
<img src="Graphics/Penetraatiotestaus/22.png" alt="" width="700" height=""/>
<p>
    -sn jättää porttiskannauksen pois, luulisin, että tällä voi päätellä onko tietokone päällä ja jättää vähemmän jälkiä.
</p>
<h4>f) nmap don't ping -Pn</h4>
<img src="Graphics/Penetraatiotestaus/23.png" alt="" width="700" height=""/>
<p>Kohtele kaikkia koneita kun ne olisivat päällä, skippaa host löytäminen. Lähde Man-Pages ”man nmap”</p>
<h4>g) nmap version detection -sV (esimerkki yhdestä palvelusta yhdessä portissa riittää)</h4>
<p>
    Avasin portin 80 komennolla “sudo ufw allow 80/tcp”
    <br>
Netti päälle koneesta
<br>
komento ”sudo apt-get install apache2”
</p>
<img src="Graphics/Penetraatiotestaus/24.png" alt="" width="700" height=""/>
<p>komento “firefox localhost” Apache pyörii koneella</p>
<img src="Graphics/Penetraatiotestaus/25.png" alt="" width="700" height=""/>
<p>komento “nmap -sV 127.0.0.2” Näyttäisi tunnistavan debianin sieltä ja apachen versio numeron</p>
<h4>h) nmap output files -oA foo. Miltä tiedostot näyttävät? Mihin kukin tiedostotyyppi sopii? </h4>
<img src="Graphics/Penetraatiotestaus/26.png" alt="" width="700" height=""/>
<p>Lähde: Man pages ”man nmap”
    <br>
    En saa toimimaan, pitäisi näyttää kolme ilmeisesti eniten käytössä olevaa tiedosto tyyppiä. Ovatko nämä .gmnmap, .nmap ja .xml
</p>
<h4>nmap ajonaikaiset toiminnot (man nmap: runtime interaction): verbosity v/V, help ?, packet tracing p/P, status s (ja moni muu nappi)</h4>
<li>-v Verbosity level nostaa tulostettavan tiedon määrää skannauksen aikana.</li>
<li>-help antaa pika opaan nmapin käyttöön. Ei niin kattava kun man nmap</li>
<li>-p Skannaa vain haluamasi porttiavaruus Lähde:  Man pages ”man nmap”</li>
<li>-s Spooffaa ip osoitteen, tämä saattaa olla minun tapauksessani kysessä. Kun Wiresharkilla en saanut tietoa sniffauksesta. Nmap kertoi, että couldn’t resolve dns. viittaisi siihen. kokeilen myöhemmin. Lähde: Man Pages ”man nmap”</li>
<h4>j) Ninjojen tapaan. Piiloutuuko nmap-skannaus hyvin palvelimelta? Vinkkejä: Asenna Apache. Aja nmap-versioskannaus -sV tai -A omaan paikalliseen weppipalvelimeen. Etsi Apachen lokista tätä koskevat rivit. Wiresharkissa "http" on kätevä filtteri, se tulee siihen yläreunan "Apply a display filter..." -kenttään. Nmap-ajon aikana p laittaa packet tracing päälle. Vapaaehtoinen lisäkohta: jääkö Apachen lokiin jokin todiste nmap-versioskannauksesta?</h4>
<p>
    kokeilin ”nmap -s -sV localhost” eipä toiminut edelleen varoitus unable to detemine any DNS servers. Reverse DNS is disabled. Veikkaukseni taisi olla väärä. tuota -s käytetään yleisemmin muiden skannausten yhteydessä nmap kertoi.
</p>
<img src="Graphics/Penetraatiotestaus/27.png" alt="" width="700" height=""/>
<p>
    Kokeilin ilman tuota -s eli komento ” nmap -sV localhost” ja katsoin apachen Acces.login. Jälkiä ei tuosta -sV:stä jäänyt muista localhostin skannauksista oli kuitenkin jäänyt.
</p>
<h4> k) UDP-skannaus. UDP-skannaa paikkalinen kone (-sU). "Mulla olis vitsi UDP:sta, mutta en tiedä menisikö se perille":
    </h4>
    <img src="Graphics/Penetraatiotestaus/28.png" alt="" width="700" height=""/>
    <p>
        Kaksi porttia auki open | filtered tilassa
    </p>
    <h4>l) Miksi UDP-skannaus on hankalaa ja epäluotettavaa? Miksi UDP-skannauksen kanssa kannattaa käyttää --reason flagia ja snifferiä? (tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)</h4>
    <p>
        Porttiskannaus olisi tehtävä nopeasti, auki olevat portit ja filtered portit harvoin lähettävät mitään vastausta, joka saa NMAPIN aikasulkeutumaan ja uudestaan lähettämään kyselyn varmuuden vuoksi, jos luotain tai vastaus vaikka katosi. useat isännät rajoittavat ICMP porttien vastaus määrää, kuten LINUX ja SOLARIS jotka ovat erittäin tiukkoja tässä. esimerkiksi LINUX 2.4.20 kerneli rajoittaa ei perille menneiden viestien määrää yhteen sekunnissa. Tämä tekee UDP Skannauksesta hidasta. 
        <br>
        Lähde: <a href="https://nmap.org/book/man-port-scanning-techniques.html">Port Scanning Techniques | Nmap Network Scanning</a> 
        <br>
        --reason flagia kannattaa käyttää, että saa tietää skannattujen porttien tilan. (open, closed, filtered) Lähde: <a href="http://www.chat.openai.com/">Chat-GPT</a>
        <br>
        Olettaisi, että snifferillä, kuten Wireshark saa enemmän tietoa, portista, kun mitä nmap antaa. En kyllä osaa vielä tulkita Wiresharkin tietoja.
    </p>
    <p>
        06.11.2023, lisähuomio, sain Wiresharkin toimimaan, kun valitsin sniffattavaksi adapteriksi ANY, nyt näyttää yhteydet, jos tekee porttiskannauksen.
    </p>
    Lähteenä raportissa on käytetty <a href="https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h2-sniff-n-scan">Hacking 2023 - Tunkeutumistestaus ict4tn027-3012 loppusyksy online (terokarvinen.com)</a>
    <h1>Haaga-Helia ammattikorkeakoulu
    </h1>
    <h2>
    Penetraatiotestaus
    </h2>
    <br>
    12.11.2023
    <br>
    <h3 id="Luento3">h3 Lab-kid</h3>
   <h3>a) Asenna Kali virtuaalikoneeseen
     , b) Asenna Metasploitable 2 virtuaalikoneeseen
     ja c) Tee koneille virtuaaliverkko, jossa (1) Kali saa yhteyden Internettiin, mutta sen voi laittaa pois päältä
    (2) Kalin ja Metasploitablen välillä on host-only network, niin että porttiskannatessa ym. koneet on eristetty intenetistä, mutta ne saavat yhteyden toisiinsa
    (3)	Osoita eri komennoilla, että Internet-yhteys katkeaa: 'ping 1.1.1.1', 'ping www.google.com', 'curl www.google.com'
    </h3>
    <p>
        
Latasin Metasploitable 2 VMware valmiin koneen oheiselta sivustolta <a href="https://docs.rapid7.com/metasploit/metasploitable-2/">Metasploitable 2 | Metasploit Documentation (rapid7.com)</a> 

    </p>
    <p>
        Seurasin videon ohjeita, miten metasploitable asennetaan omaan verkkoon Vmwaressa Kalin kanssa <a href="https://www.youtube.com/watch?v=Jgiv88_pBbU">(347) Metasploitable and kali setup in vmware on private network - YouTube</a>
    </p>
    <img src="Graphics/Penetraatiotestaus/29.png" alt="" width="700" height=""/>
    <p>
        Loin uuden virtuaalisen verkon VMnet2 host-only j poistin valinnan connect a host virtual adapter to this network DHCP palvelun jätin päälle.
    </p>
    <img src="Graphics/Penetraatiotestaus/30.png" alt="" width="700" height=""/>
    <p>
        Laitoin metasploitablen network 2 adapterin kiinni tuohon juuri luotuun virtuaaliseen VMnet2 verkkoon. Laitoin vielä kuvasta poiketen varmuuden vuoksi Network adapter (1) NAT valinnan tilaan Host-only: A private network shared with the host.
    </p>
    <p>
        Kalin koneen asetuksissa : 
    </p>
    <img src="Graphics/Penetraatiotestaus/31.png" alt="" width="700" height=""/>
    <p>
        Tein samat muutokse, myös kuvasta poiketen network adapter (1) NAT valinta muotoon Host-Only.
<br>        
Nyt käsittääkseni koneet pitäisi olla kytketty pois internetistä, mutta niiden välillä on verkkoyhteys.
<br>
ja testaaamaan. Kalin internetin saa päälle vaihtamalla Network adapterin NAT valinnan päälle. Kokeilin tätä Kalin asennus vaiheessa ja se toimi.
</p>
<img src="Graphics/Penetraatiotestaus/32.png" alt="" width="700" height=""/>
<p>
    Kali käyttöjärjestelmän testi Firefoxilla google.comiin 
</p>
<img src="Graphics/Penetraatiotestaus/33.png" alt="" width="700" height=""/>
<p>
    ja vielä ping komento, Kali linux ei saa yhteyttä internettiin
</p>
<img src="Graphics/Penetraatiotestaus/34.png" alt="" width="700" height=""/>
<p>
    Metasploitablessa komento ”ifconfig” saa selville ip osoitteen, joka on 192.168.159.130
</p>
<img src="Graphics/Penetraatiotestaus/35.png" alt="" width="700" height=""/>
<p>
    Kalista käsin Pingasin 192.168.159.130 joka on metaspoloitablen osoite ja se vastaa, verkko siis toimii. packet loss 0% ja latenssi olematon, joten se siis on lähiverkossa oleva kone.
</p>
<h3>d) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable. Katso, ettei skannauspaketteja vuoda Internetiin - kannattaa irrottaa koneet netistä skannatessa.</h3>
<img src="Graphics/Penetraatiotestaus/36.png" alt="" width="700" height=""/>
<p>
    Testi kali järjestelmällä, kun network adapter 1 on NAT asennossa ja netti toimii.
</p>
<img src="Graphics/Penetraatiotestaus/37.png" alt="" width="700" height=""/>
<p>
    NAT asetus pois päältä ja Host-only asentoon virtuaalikoneen asetuksista ja vielä testi, että netti ei toimi mutta metasploitable vastaa.
komento ”nmap  -sn 192.168.159.130”

</p>
<img src="Graphics/Penetraatiotestaus/38.png" alt="" width="700" height=""/>
<p>
    Menin ip osoitteeseen ja sieltä aukesi metasploitablen weppi palvelin  
</p>
<img src="Graphics/Penetraatiotestaus/39.png" alt="" width="700" height=""/>
<img src="Graphics/Penetraatiotestaus/40.png" alt="" width="700" height=""/>
<p>
portti 21/tcp auki, ftp ei enää turvallinen tapa
<br>
portti 22/tcp ssh portti auki, en tiedä onko tavallista, että tuossa näkyy nuo ssh-hostkey:t näkyvillä. Olisiko niillä mahdollista saada kone haltuun?
<br>
portti 23/tcp telnet auki. Onko tämäkin vanhentunut tapa?
<br>
portti 25/tcp smtp sähköpostipalvelimen lähetys portti. en osaa sanoa, kuinka haavoittuvainen tämä on
<br>
53/tcp en tiedä mikä on
<br>
80/tcp weppi palvelin ja siellä pyörii se metasploitablen nettisivu.
<br>
111/tcp en tiedä mikä on
<br>
139/tcp Samba jako Workgroup, sanoisin, että haavoittuvainen, vaikuttaa windows jaolta 
<br>
445/tcp Sama Samba tekniikkalla tuotettu jako mutta nyt visiin Linux puolelle, en osaa tarkasti sanoa.
<br>
512- 2121 ei tietoa
<br>
3306/tcp jonkin näköinen mySql tietokanta, versionumeron perusteella voi katsoa haavoittuvuudet.
<br>
3632/tcp ei tietoa
<br>
3432/tcp posgresql tietokanta
<br>
6000/tcp ei tietoa
<br>
6667 irc serveri
<br>
6697 irc
<br>
8009-8180 liittyisikö java ohjelmointiin olisiko devaus palvelin.
</p>
<h3>f) Murtaudu Metasploitablen VsFtpd-palveluun Metasploitilla (search vsftpd, use 0, set RHOSTS - varmista osoite huolella, exploit, id)</h3>
<p>
    ensimmäinen artikkeli ei avautunut minulle aluksi niin käytin näitö ohjeita <a href="https://www.stationx.net/how-to-use-metasploit-in-kali-linux/">How to Use Metasploit in Kali Linux: A Step-By-Step Tutorial (stationx.net)</a>
<br>
Metasploit käyntiin ohjeiden avulla
</p>
<img src="Graphics/Penetraatiotestaus/41.png" alt="" width="700" height=""/>
<p>
    toisessa terminaalissa komento “sudo service postgresql start”
</p>
<img src="Graphics/Penetraatiotestaus/42.png" alt="" width="700" height=""/>
<p>
    Komento “db_status” nyt pitäisi olla yhdistetty tietokantaan.  
</p>
<img src="Graphics/Penetraatiotestaus/43.png" alt="" width="700" height=""/>
<p>
    Loin Workspacen kyseiselle hyökkäykselle komennolla ”workspace -a metasploitable2vsftpd”
sitten komento ”workspace metasploitable2vsftpd” siirryin workspaceen

</p>
<img src="Graphics/Penetraatiotestaus/44.png" alt="" width="700" height=""/>
<p>Laitoin komennon “search vsftpd” ja ”use 1” koska siellä luki backdoor, ajattelin sen olevan sopiva ja rank oli execellent</p>
<img src="Graphics/Penetraatiotestaus/45.png" alt="" width="700" height=""/>
<p>
    asetin rhosti eli kohde osoitteen ja lhostin eli hyökkäävän osoitteen, en tiedä menikö se läpi, osoite oli kuitenkin kali käyttöjärjestelmän ip. Laitoin komennon ”exploit” ja ilmeisesti pääsin sisään mutta shelli oli vielä huono. 
</p>
<img src="Graphics/Penetraatiotestaus/46.png" alt="" width="700" height=""/>
<p>
    Todisteet vielä, ajoin ”ls” komennon ja näen palvelimen tiedosto rakenteen.
</p>
<h3>g) Parempi sessio. Tee vsftpd-hyökkäyksestä saadusta sessiosta parempi. (Voit esimerkiksi päivittää sen meterpreter-sessioksi, laittaa tty:n toimimaan tai tehdä uuden käyttäjän ja ottaa yhteyden jollain tavallisella protokollalla)</h3>
<p>
    aika loppui kesken 0.41 Sunnuntai... pitää nukkua
</p>
<h3>h) Etsi, tutki ja kuvaile jokin hyökkäys ExploitDB:sta. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi)</h3>
<h3>i) Etsi, tutki ja kuvaile hyökkäys 'searchsploit' -komennolla. Muista päivittää. (Tässä harjoitustehtävässä pitää hakea ja kuvailla hyökkäys, itse hyökkääminen jää vapaaehtoiseksi lisätehtäväksi. Valitse eri hyökkäys kuin edellisessä kohdassa.)</h3>
<h3>j) Kokeile vapaavalintaista haavoittuvuusskanneria johonkin Metasploitablen palveluun. (Esim. nikto, wpscan, openvas, nessus, nucleus tai joku muu)</h3>
<h3>k) Kokeile jotain itsellesi uutta työkalua, joka mainittiin x-kohdan läpikävelyohjeessa.</h3>
Lähteenä raportissa on käytetty <a href="https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#aikataulu">Hacking 2023 - Tunkeutumistestaus ict4tn027-3012 loppusyksy online (terokarvinen.com)</a>
<h1>Haaga-Helia ammattikorkeakoulu
</h1>
<h2>
Penetraatiotestaus
</h2>
<br>
18.11.2023
<br>
<h4 id="Luento4">h4 Totally Legit Sertificate</h4>
<h3>x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)
    <li>OWASP 2021: OWASP Top 10:2021</li>
    <li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Broken Access Control (IDOR ja path traversal ovat osa tätä)</a> </li>
    </h3>
    <li>Vähimmäisoikeusperiaatteen tai oletuskiellon rikkominen, jossa käyttöoikeus tulisi myöntää vain tietyille toiminnoille, rooleille tai käyttäjille, mutta se on saatavilla kenelle tahansa.</li>
    <li>Pääsynhallinnan ohittaminen muokkaamalla URL-osoitetta (parametrin manipulointi tai pakotettu selaaminen), sovelluksen sisäistä tilaa, HTML-sivua tai käyttämällä hyökkäystyökalua API-pyyntöjen muokkaamiseen.</li>
    <li>Sallii toisen henkilön tilin katselun tai muokkauksen tarjoamalla sen yksilöllisen tunnisteen (turvattomat suorat objektiviitteet).</li>
    <li>API:n käyttäminen puuttuvilla pääsynhallintamekanismeilla POST, PUT ja DELETE -pyyntöihin.</li>
    <li>Käyttöoikeuksien korottaminen. Toimiminen käyttäjänä ilman kirjautumista tai adminina kirjautuneena tavallisena käyttäjänä.</li>
    <li>Metatiedon manipulointi, kuten JSON Web Token (JWT) pääsynhallintamerkin uudelleenlähetys tai manipulointi, tai evästeen tai piilotetun kentän muokkaaminen käyttöoikeuksien korottamiseen tai JWT:n mitätöinnin väärinkäyttöön.</li>
    <li>CORS-väärinkonfigurointi mahdollistaa API-pääsyn luvattomista/luottamattomista lähteistä.</li>
    <li>Pakotettu selaaminen autentikoituihin sivuihin autentikoimattomana käyttäjänä tai privilegioituihin sivuihin tavallisena käyttäjänä.</li>
    <p>Voidaan estää tavoilla:</p>
    <li>Lukuun ottamatta julkisia resursseja, käytä oletusarvoisesti kieltämisperiaatetta.</li>
    <li>Toteuta pääsynhallintamekanismit kerran ja käytä niitä uudelleen koko sovelluksessa, mukaan lukien Cross-Origin Resource Sharing (CORS) käytön minimointi.</li>
    <li>Mallin pääsynhallintojen tulisi valvoa tietueen omistajuutta sen sijaan, että hyväksyttäisiin, että käyttäjä voi luoda, lukea, päivittää tai poistaa mitä tahansa tietuetta.</li>
    <li>Yksilölliset sovellusliiketoiminnan rajoitusvaatimukset tulisi valvoa toimialamalleilla.</li>
    <li>Poista web-palvelimen hakemistolistaus käytöstä ja varmista, että tiedostometatietoja (esim. .git) ja varmuuskopiotiedostoja ei ole web-juurissa.</li>
    <li>Kirjaa pääsynhallinnan epäonnistumiset, hälytä ylläpitäjiä tarvittaessa (esim. toistuvat epäonnistumiset).</li>
    <li>Rajoita API:n ja ohjaimen pääsyä määrällisesti vähentääksesi automatisoitujen hyökkäystyökalujen aiheuttamaa vahinkoa.</li>
    <li>Tilaan perustuvat istuntotunnisteet tulisi mitätöidä palvelimella uloskirjautumisen jälkeen. Tilaamattomat JWT-tunnukset tulisi olla lyhytaikaisia, jotta hyökkääjän mahdollisuusikkuna minimoidaan. Pidempikestoisille JWT-tunnisteille on erittäin suositeltavaa noudattaa OAuth-standardeja pääsyn peruuttamiseksi.</li>
<p>
    Lähde: <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Broken Access Control (IDOR ja path traversal ovat osa tätä) Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li><a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/"> Server-Side Request Forgery (SSRF)</a></li></h3>
<li>SSRF-virheet tapahtuvat aina, kun web-sovellus noutaa etäresurssin validioimatta käyttäjän toimittamaa URL-osoitetta. Se mahdollistaa hyökkääjän pakottaa sovelluksen lähettämään muokatun pyynnön odottamattomaan kohteeseen, vaikka se olisi suojattu palomuurilla, VPN:llä tai muulla verkon pääsynhallintalistalla (ACL).</li>
<li>Kun modernit web-sovellukset tarjoavat loppukäyttäjille käteviä ominaisuuksia, URL-osoitteen noutaminen muodostuu yleiseksi skenaarioksi. Tämän seurauksena SSRF:n esiintyminen on lisääntymässä. Lisäksi SSRF:n vakavuus kasvaa pilvipalvelujen ja arkkitehtuurien monimutkaisuuden vuoksi.</li>
<p>Voidaan estää tavoilla:</p>
<p>Verkkokerroksesta:</p>
<li>Segmentoi etäresurssien käyttötoiminnot erillisiin verkkoihin SSRF:n vaikutusten vähentämiseksi.</li>
<li>Valvo 'kiellä oletusarvoisesti' -palomuurikäytäntöjä tai verkon pääsynhallintasääntöjä, jotta kaikki muu paitsi välttämätön intranet-liikenne estetään.</li>
<p>Sovelluskerroksesta:</p>
<li>Puhdista ja validoi kaikki asiakkaan toimittamat syöttötiedot.</li>
<li>Valvo URL-kaavaa, porttia ja kohdetta positiivisen sallimislistan avulla.</li>
<li>Älä lähetä raakoja vastauksia asiakkaille.</li>
<li>Poista HTTP-uudelleenohjaukset käytöstä.</li>
<li>Ole tietoinen URL:n johdonmukaisuudesta välttääksesi hyökkäyksiä, kuten DNS-uudelleensidonta ja 'tarkistuksen ajan, käytön ajan' (TOCTOU) kilpailutilanteet.</li>
<li>Älä lievennä SSRF-ongelmaa käyttämällä kieltolistaa tai säännöllisiä lausekkeita. Hyökkääjillä on kuormalistoja, työkaluja ja taitoja kieltolistojen ohittamiseen.</li>
<p>
    Lähde: <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/"> Server-Side Request Forgery (SSRF) Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li>PortSwigget Academy:</li><li><a href="https://portswigger.net/web-security/access-control">Access control vulnerabilities and privilege escalation (IDOR on osa tätä)</a></li>
    </h3>
    <li>Pääsynhallinta on rajoitusten soveltamista siihen, kuka tai mikä on valtuutettu suorittamaan toimenpiteitä tai käyttämään resursseja. Web-sovellusten kontekstissa pääsynhallinta perustuu autentikointiin ja istunnonhallintaan:</li>
    <li>Autentikointi vahvistaa, että käyttäjä on se, kuka sanoo olevansa.</li>
    <li>Istunnonhallinta tunnistaa, mitkä seuraavista HTTP-pyynnöistä tehdään saman käyttäjän toimesta.</li>
    <li>Pääsynhallinta määrittää, onko käyttäjällä oikeus suorittaa yrittämäänsä toimintoa.</li>
    <li>Rikkinäiset pääsynhallintamekanismit ovat yleisiä ja usein esittävät kriittisen turvallisuusongelman. Pääsynhallinnan suunnittelu ja hallinta on monimutkainen ja dynaaminen ongelma, joka soveltaa liiketoiminnallisia, organisaation ja laillisia rajoituksia tekniseen toteutukseen. Pääsynhallinnan suunnittelupäätökset on tehtävä ihmisten toimesta, joten virheiden mahdollisuus on suuri.</li>
    <p>Pääsynhallinnan haavoittuvuudet voidaan estää ottamalla käyttöön monitasoinen puolustus ja soveltamalla seuraavia periaatteita:</p>
    <li>Älä koskaan luota pelkkään hämärtämiseen pääsynhallinnassa. Ellei resurssi ole tarkoitettu julkisesti saataville, kiellä pääsy oletusarvoisesti</li>
    <li>Käytä mahdollisuuksien mukaan yhtä sovelluslaajuista mekanismia pääsynhallinnan valvontaan.</li>
    <li>Kooditasolla tee kehittäjille pakolliseksi ilmoittaa, mikä pääsy on sallittu kullekin resurssille, ja kiellä pääsy oletusarvoisesti.</li>
    <li>Tarkasta ja testaa pääsynhallinta perusteellisesti varmistaaksesi, että se toimii suunnitellusti.</li>
<p>
    Lähde: <a href="https://portswigger.net/web-security/access-control">Access control vulnerabilities and privilege escalation (IDOR on osa tätä) Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li><a href="https://portswigger.net/web-security/server-side-template-injection">Server-side template injection</a></li></h3>
<p>
    Palvelinpuoleinen mallineen injektio tapahtuu, kun hyökkääjä pystyy käyttämään natiivia mallinekieltä syöttääkseen haitallisen kuorman mallineeseen, joka sitten suoritetaan palvelimen puolella. 
</p>
<p>
   Mallinekoneet on suunniteltu tuottamaan verkkosivuja yhdistämällä kiinteitä mallineita vaihteleviin tietoihin. Palvelinpuoleiset mallineen injektiohyökkäykset voivat tapahtua, kun käyttäjän syöte liitetään suoraan mallineeseen, sen sijaan että se välitettäisiin datana. Tämä antaa hyökkääjille mahdollisuuden injektoida mielivaltaisia mallineohjeita manipuloidakseen mallinekonetta, usein mahdollistaen heille täydellisen hallinnan palvelimen yli. Kuten nimi viittaa, palvelinpuoleiset mallineen injektiokuormat toimitetaan ja arvioidaan palvelimen puolella, mikä tekee niistä mahdollisesti paljon vaarallisempia kuin tyypilliset asiakaspuolen mallineen injektiot.
 </p>
 <p>
    Miten estää palvelinpuoleiset mallineen injektiohaavoittuvuudet
 </p>
<p>
    Paras tapa estää palvelinpuoleiset mallineen injektiot on olla sallimatta käyttäjien muokata tai lähettää uusia mallineita. Tämä on kuitenkin joskus välttämätöntä liiketoimintavaatimusten vuoksi.
</p>
<p>
    Yksi yksinkertaisimmista tavoista välttää palvelinpuoleiset mallineen injektiohaavoittuvuudet on aina käyttää "logiikattomia" mallinekoneita, kuten Mustache, ellei se ole ehdottoman välttämätöntä. Logiikan erottaminen esityksestä mahdollisimman paljon voi suuresti vähentää altistumistasi vaarallisimmille mallinepohjaisille hyökkäyksille.
</p>
<p>
    Toinen toimenpide on suorittaa käyttäjien koodi hiekkalaatikkoympäristössä, josta mahdollisesti vaaralliset moduulit ja funktiot on poistettu kokonaan. Valitettavasti epäluotettavan koodin hiekkalaatikointi on luonteeltaan vaikeaa ja altis ohituksille.
</p>
<p>
    Lopuksi toinen täydentävä lähestymistapa on hyväksyä, että mielivaltainen koodin suorittaminen on lähes väistämätöntä ja soveltaa omaa hiekkalaatikointiasi käyttämällä mallineympäristöäsi esimerkiksi tiukasti rajoitetussa Docker-säiliössä.
</p>
<p>
    Lähde: <a href="https://portswigger.net/web-security/server-side-template-injection">Server-side template injection Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li><a href="https://portswigger.net/web-security/ssrf">Server-side request forgery (SSRF)</a></li></h3>
<p>
    SSRF-hyökkäykset hyödyntävät usein luottamussuhteita laajentaakseen hyökkäystä haavoittuvasta sovelluksesta ja suorittaakseen luvattomia toimia. Nämä luottamussuhteet voivat olla olemassa palvelimeen liittyen tai muihin saman organisaation taustajärjestelmiin liittyen.  
</p>
<p>
    Lähde: <a href="https://portswigger.net/web-security/ssrf">Server-side request forgery (SSRF) Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li><a href="https://portswigger.net/web-security/cross-site-scripting">Cross-site scripting</a></li></h3>
<p>
    Poikkisivujen skriptaus (tunnetaan myös nimellä XSS) on verkkoturvallisuuden haavoittuvuus, joka mahdollistaa hyökkääjän vaarantaa käyttäjien vuorovaikutukset haavoittuvan sovelluksen kanssa. Se mahdollistaa hyökkääjän kiertää saman alkuperän politiikan, joka on suunniteltu eristämään eri verkkosivustot toisistaan. Poikkisivujen skriptauksen haavoittuvuudet sallivat yleensä hyökkääjän esiintyä uhri-käyttäjänä, suorittaa kaikki toimet, joita käyttäjä pystyy tekemään, ja päästä käsiksi mihin tahansa käyttäjän dataan. Jos uhri-käyttäjällä on etuoikeutettu pääsy sovelluksessa, hyökkääjä saattaa pystyä saavuttamaan täyden hallinnan sovelluksen kaikkien toimintojen ja datan yli. 
</p>
<p>Estääksesi poikkisivujen skriptaus (XSS) -hyökkäykset, tehokas suojaus saattaa edellyttää useiden seuraavien toimenpiteiden yhdistelmää:</p>
<li>Suodata tietoja saapuessa. Siinä vaiheessa, kun käyttäjän syöte vastaanotetaan, suodata se mahdollisimman tiukasti perustuen siihen, mikä on odotettua tai kelvollista syötettä.</li>
<li>Koodaa tiedot lähtiessä. Siinä vaiheessa, kun käyttäjän hallinnoima data tuotetaan HTTP-vastauksissa, koodaa tulos estääksesi sen tulkinnan aktiivisena sisältönä. Riippuen tulostusyhteydestä, tämä voi vaatia HTML-, URL-, JavaScript- ja CSS-koodauksen yhdistelmien soveltamista.</li>
<li>Käytä sopivia vastausotsikoita. Estääksesi XSS:n HTTP-vastauksissa, jotka eivät ole tarkoitettu sisältämään HTML:ää tai JavaScriptiä, voit käyttää Content-Type- ja X-Content-Type-Options -otsikoita varmistaaksesi, että selaimet tulkitsevat vastaukset niin kuin olet tarkoittanut.</li>
<li>Sisältöturvapolitiikka. Viimeisenä puolustuslinjana voit käyttää Content Security Policy (CSP) -toimenpiteitä vähentämään mahdollisesti esiintyvien XSS-haavoittuvuuksien vakavuutta.</li>
<p>
    Lähde: <a href="https://portswigger.net/web-security/cross-site-scripting">Cross-site scripting Chat-GPT käännös osasta komennolla translate to Finnish</a>
</p>
<h3><li><a href="https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/">Using New Webgoat 2023.4 to Try Web Hacking</a></li></h3>
<p>
    Artikkeli käsittelee WebGoatin asennusta ja sen käyttämistä vaihtoehtoisessa tietoliikenne porttinumerossa.
</p>
<h3>a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimi localhost:lla ilman Foxyproxya)</h3>
<img src="Graphics/Penetraatiotestaus/47.png" alt="" width="700" height=""/>
<p>Latasin Zap crossplatform paketin ja purin sen kansioon home/ilkkah/Downloads/Zap_2.14.0/</p>
<p>
    Komento ”sudo apt-get update”
    <br>
    Komento ”sudo apt-get install default-jre”
</p>
<img src="Graphics/Penetraatiotestaus/48.png" alt="" width="700" height=""/>
<p>
    komento “java -jar zap_2.14.0” käynnisti Zapin. 
    <br>
    Tässä vaiheessa siirryin tehtävään b) ja asensin FoxyProxy lisäosan Firefoxiin ja sitten palasin takaisin tähän tehtävään.
</p>
<img src="Graphics/Penetraatiotestaus/49.png" alt="" width="700" height=""/>
<p>
    Kävin tarkastamassa Zapin asetuksista osoitteen (localhost) ja portin 8080
</p>
<img src="Graphics/Penetraatiotestaus/50.png" alt="" width="700" height=""/>
<p>
    FoxyProxyn asetuksita lisäsin uuden proxyn ja asetin IP osoitteeksi kuvasta poiketen localhost ja portti 8080 niin kuin Zapinkin asetuksissa.
</p>
<img src="Graphics/Penetraatiotestaus/51.png" alt="" width="700" height=""/>
<p>Menin osoitteeseen google.com Firefoxilla ja tulos oli tämä Firefox varoitti turvattomasta yhteydestä.</p>
<img src="Graphics/Penetraatiotestaus/52.png" alt="" width="700" height=""/>
<p>Loin Zapilla sertifikaatin ja lisäsin sen Firefoxiin</p>
<img src="Graphics/Penetraatiotestaus/53.png" alt="" width="700" height=""/>
<p>
    Menin Firefoxilla osoitteeseen www.google.com ja zap toimi nyt välimies proxyna ja tallensi liikenteen. Sertifikaatti valitusta ei Firefox enää antanut.
</p>
<h3>b) Kettumaista. Asenna FoxyProxy Standard Firefox Addon, ja lisää ZAP proxyksi siihen.</h3>
<p>Tein tämän tehtävän, tuolla a) tehtävän aikana</p>
<img src="Graphics/Penetraatiotestaus/54.png" alt="" width="700" height=""/>
<p>
    Asensin Foxy Proxy Standardin Fitefoxin extensions valikosta.
</p>
<h3>PortSwigger Labs. Ratkaise tehtävät. Selitä ratkaisusi: mitä palvelimella tapahtuu, mitä eri osat tekevät, miten hyökkäys löytyi, mistä vika johtuu. (Voi käyttää ZAPia, vaikka malliratkaisut käyttävät harjoitusten tekijän maksullista ohjelmaa)
    <li>Insecure Direct Object Reference (IDOR)</li>
    <li><a href="https://portswigger.net/web-security/access-control/lab-insecure-direct-object-references">Insecure direct object references</a></li>
</h3>
<p>
    En oikein saanut selvää mitä tässä pitää tehdä ja en päässyt eteenpäin. Kokeilin Zapin Hudia, mutta en ottanut kuvia. En Päässyt sitä loppuun asti, kun en tajunnut kaikkia ominaisuuksia mistä keyt olisi pitänyt löytää.
    <br>
    Kokeilin kuitenkin tehtäävää mutta, en löytänyt salasanaa nimettyäni tiedostonimen, mutta tämä johtui siitä että en perehtynyt tarpeeksi ZAPin käyttöön. Yritin jotenkin väärällä tavalla. Tuntui myös, että ZAPIN käyttö hidasti konetta merkittävästi ja nettiliikennettä.
</p>
<h3><li>Path traversal</li>
<li>d) <a href="https://portswigger.net/web-security/file-path-traversal/lab-simple">File path traversal, simple case</a></li>
<li>e) <a href="https://portswigger.net/web-security/file-path-traversal/lab-absolute-path-bypass">File path traversal, traversal sequences blocked with absolute path bypass</a></li>
<li>f) <a href="https://portswigger.net/web-security/file-path-traversal/lab-sequences-stripped-non-recursively">File path traversal, traversal sequences stripped non-recursively</a></li>
</h3>
<p>En kokeillut vielä näitä</p>
<h3>Server Side Template Injection (SSTI)
<li>g) <a href="https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-with-information-disclosure-via-user-supplied-objects">Server-side template injection with information disclosure via user-supplied objects </a></li>
</h3>
<p>En kokeillut vielä tätä</p>
<h3>Server Side Request Forgery (SSRF)
    <li>h) <a href="https://portswigger.net/web-security/ssrf/lab-basic-ssrf-against-localhost">Basic SSRF against the local server</a></li>
</h3>
<p>En kokeillut vielä tätä, palaan tähän</p>
<h3><li>Cross Site Scripting (XSS)</li>
    <li>i) <a href="https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded">Reflected XSS into HTML context with nothing encoded</a></li>
    <li>j) <a href="https://portswigger.net/web-security/cross-site-scripting/stored/lab-html-context-nothing-encoded">Stored XSS into HTML context with nothing encoded</a></li>
    <p>En kokeillut vielä näitä, palaan näihin</p>
</h3>
<h3>k) Asenna Webgoat 2023.4. (Uusi versio, jossa on eri tehtäviä kuin vanhemmissa)</h3>
<p>
    Seurasin Teron ohjeita asentamiseen: <a href="https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/">Try Web Hacking on New Webgoat 2023.4</a>
</p>
<p>
    Skippasin javan asennuksen, kun se oli jo asennettu.
</p>
<img src="Graphics/Penetraatiotestaus/55.png" alt="" width="700" height=""/>
<p>
    Komento ”sudo apt-get install ufw” asensin palomuurin
    <br>
“sudo ufw enable” käynnistin palomuurin
<br>
“sudo ufw status” katsoin palomuurin tilan ja se oli aktiivinen
</p>
<p>
    Komento ”wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar” latasin WebGoatin koneelle
</p>
<img src="Graphics/Penetraatiotestaus/56.png" alt="" width="700" height=""/>
<p>Komento ”java -Dfile.encoding=UTF-8 -Dwebgoat.port=8888 -Dwebwolf.port=9090 -jar webgoat-2023.4.jar” käynnisti WebGoatin toimimaan portissa 8888, en ole varma mikä tuo portti 9090 on.</p>
<p>
    Menin selaimella osoitteeseen http://127.0.0.1:8888/WebGoat ja aukesi WebGoatin login näkymä. En rekisteröitynyt. En oikestaa vielä tiedä mikä on WebGoatin tarkoitus. Sanoisin, että se on harjoitusmaali, jossa voi harjoitella hyökkäyksiä.</p>
<p>En ole avain varma onko ympäristön täysin turvallinen sen pitämiseen päällä tällä hetkellä. Tuli muuriminulla on päällä virtuaalikoneessa, mutta tämä olisi varmaan pitänyt asentaa siis toiseen virtuaali koneeseen kun Kaliin, enpä perehtynyt tarpeeksi asiaan.</p>
<p>
    Lähteenä raportissa on käytetty <a href="https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#aikataulu">Hacking 2023 - Tunkeutumistestaus ict4tn027-3012 loppusyksy online (terokarvinen.com)</a>
</p>
<h1>Haaga-Helia ammattikorkeakoulu
</h1>
<h2>
Pentest
</h2>
<br>
24.11.2023
<br>
<h4 id="Luento5">h5 Injected Sequel</h4>
<h3>Karvinen 2016: <a href="https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/"> PostgreSQL Install and One Table Database – SQL CRUD tutorial for Ubuntu </a>(Virtuaaliympäristöä ei tarvita, voit aloittaa kohdasta "Three line install")</h3>
<h4>Asennus</h4>
<li>”sudo apt-get update”</li>
<li>”sudo apt-get -y install postgresql</li>
<li>”sudo systemctl start postgres</li>
<li>“sudo -u postgres createdb $(whoami)”</li>
<li>“sudo -u postgres createuser $(whoami)”</li>
<li>“psql”</li>
<h4>Apu</h4>
<li>"help"</li>
<li>”\q” poistuu</li>
<li>”\?” listaa psql komennot</li>
<li>"\h" listaa SQL komennot</li>
<h4>CRUD, Create, Read, Update, Delete
<br>
C: luo taulu</h4>
<li>“CREATE TABLE students (id SERIAL PRIMARY KEY, name VARCHAR (200));”</li>
<h4>C: Luo sisältöä INSERT</h4>
<li>“INSERT INTO students(name) VALUES ('Matti');”</li>
<li>   “INSERT INTO students(name) VALUES ('Maija');”</li>
<li>  “INSERT INTO students(name) VALUES ('Liisa') RETURNING id, name;”
</li>
<h4>R: lue sisältöä SELECT</h4>
<li>“SELECT * FROM students;”</li>
<li>“SELECT * FROM students WHERE name LIKE 'Ma%';”</li>
<h4>U: päivitä sisältöä UPDATE</h4>
<li>“UPDATE students SET name = 'Tero Karvinen' WHERE name='Tero';”</li>
<li>"UPDATE 1"</li>
<h4>D: poista sisältöä DELETE</h4>
<li>“DELETE FROM students WHERE name='Liisa';”</li>
<li>"DELETE 1"</li>
<h3>OWASP 2017: <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">A1:2017-Injection</a> </h3>
<h4>Esimerkki hyökkäys skenaariot</h4>
<h5>Ensimmäinen skenaario:</h5>
<p>
String query = "SELECT * FROM accounts WHERE custID='" + request.getParameter("id") + "'";
</p>
<h5>Toinen Skenaario:</h5>
<p>
Query HQLQuery = session.createQuery("FROM accounts WHERE custID='" + request.getParameter("id") + "'");
</p>
<p>
Molemmissa skenaariossa hyökkääjä modifioi ”id” parametriä selaimessaan lähettääkseen ’ or ’1’=’1.
<br>
Tämä muuttaa kummassakin skenaarioissa haun merkityksen ja palauttaa kaikki tiedot tietokannassa ”accounts” taulusta. Käsittääkseni tuo OR ’1’=’1’ aina tosi ja tästä syystä palautuu kaikki tiedot.
</p>
<h3>PortSwigger Academy: <a href="https://portswigger.net/web-security/sql-injection">SQL injection</a> </h3>
<p>
Luin materiaalin, mutta ajan säästämiseskis en tehny tiivistelmää. Tämä on kuitenkin hyvä materiaali, jota kannattaa lukea.
</p>
<h4>a) CRUD. Tee uusi PostgreSQL-tietokanta ja demonstroi sillä create, read, update, delete (CRUD). Keksi taulujen ja kenttien nimet itse. Taulujen nimet monikossa, kenttien nimet yksikössä, molemmat englanniksi.</h4>
<li>“sudo apt-get update”</li>
<li>“sudo apt-get install postgresql”</li>
<li>“sudo systemctl start postgresql”</li>
<li> “sudo -u postgres createdb $(whoami)”</li>
<li>“sudo -u postgres createuser $(whoami)”</li>
<img src="Graphics/Penetraatiotestaus/57.png" alt="" width="700" height=""/>
<p>Tietokanta ja käyttäjä on luotu ja käynnistin tietokannan ”psql” komennolla</p>
<img src="Graphics/Penetraatiotestaus/58.png" alt="" width="700" height=""/>
<p>
    “CREATE TABLE users (id SERIAL PRIMARY KEY, email VARCHAR (200));” Tuli virheilmoitus, enkä saanut luotua taulua users.
    ei aikaa nyt perehtyä tähän, jatkan eteenpäin.
</p>
<h4>b) SQLi me. Kuvaile yksinkertainen SQL-injektio, ja demonstroi se omaan tietokantaasi psql-komennolla. Selitä, mikä osa on käyttäjän syötettä ja mikä valmiina ohjelmassa. (Tässä harjoituksessa voit vain kertoa koodista, ei siis tarvitse välttämättä koodata sitä ohjelmaa, joka yhdistää käyttäjän syötteen SQL:n)</h3>
    <p>
        SQL-injektio on hyökkäys, jossa hyökkääjä syöttää SQL-komentoja käyttäjän syötteeseen. Tämä on mahdollista, kun käyttäjän syöte ei ole tarpeeksi tarkistettu ja se välitetään suoraan tietokantaan. Tämä mahdollistaa hyökkääjän suorittaa SQL-komentoja tietokannassa.
        <br>
        Helppo SQL injektio, muuttaa selaimessa palautuvaa osoitetta esim.  '-- joka tarkoittaa kommenttia, jolloin -- takana olevaa SQL koodia ei lueta.
        <br>
        En kuitenkaan saanut A tehtävässä taulua luotua, niin en voi demonstroida tätä.
    </p>
    <h4>c) Poistettu</h4>
    <h4>d) <a href="https://portswigger.net/web-security/sql-injection/lab-login-bypass"> SQL injection vulnerability allowing login bypass</a></h4>
    <img src="Graphics/Penetraatiotestaus/59.png" alt="" width="700" height=""/>
    <p>Kaapasin liikenteen Zapilla ja löysin sieltä oikean kohdan jossa syöttämäni tiedot näkyivät. Muokkasin kohtaa username=administrator’--, joka siis kommentoi password kohdan pois ja näin sain ratkaistuksi tehtävän. En katsonut ohjetta tähän, mutta tämän ratkaisuhan luki saamissamme Portswigger teoria materiaalissa.</p>
    <h4>e) <a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle">SQL injection attack, querying the database type and version on Oracle</a> </h4>
    <img src="Graphics/Penetraatiotestaus/60.png" alt="" width="700" height=""/>
    <p>
        Katsoin ratkaisun mutta en silti saanut syötettyä annettua injektiota oikeaan paikkaan. Yritin muokata category parametria, seuraavalla injektiolla '+UNION+SELECT+'abc','def'+FROM+dual-- tuloksetta, en saanut tietokannan versiota näkyviin.
    </p>
    <h4>f) <a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft"> SQL injection attack, querying the database type and version on MySQL and Microsoft</a></h4>
    <p>Kun en pääsyt aikaisemmasta eteenpäin. Katsoin vihjeen, ratkaisun ja videon miten tämä tehtävä tehdään</p>
    <img src="Graphics/Penetraatiotestaus/61.png" alt="" width="700" height=""/>
    <p>Kokeilin syöttää videon ohjeiden muikaisesti Gifts kaegorian perään '+UNION+SELECT+'abc','def'#</p>
    <p>Serverin vastaus oli OK ja kävin katsomassa nettisivua Firefoxilla ja tosissaan sinne oli tulostunut alas abc ja def ja näin pystyi todentamaan, että SQL haavoittuvuus oli löytynyt.</p>
    <img src="Graphics/Penetraatiotestaus/62.png" alt="" width="700" height=""/>
    <p>MySQL versio 8.0.35 joka varmaankin pyöri Linuxin vanhassa versioss 20.04.1 Muistaakseni LTS versio, joka alkaa kyllä olemaan jo vanha.</p>
    <h4>g) <a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-oracle">SQL injection attack, listing the database contents on non-Oracle databases</a> </h4>
    <P>Onko otsikossa virhe? linkki ohjasi nimenomaan contents on Oracle database?</P>
    <p>Katsoin vihjee ja ratkaisun</p>
    <p>+UNION+SELECT+'abc','def'+FROM+dual--</p>
    <p>Tämän kun syötti requesteriin ja lähetti, tulostui taas abc ja def sivulle, haavoittuvuus oli olemassa.</p>
    <p>Kokeilin syöttää toisen vastauksessa olevan SQL injektion, serveri vastasi 200 ok ja katsoin tuloksen Firefoxissa. </p>
    <img src="Graphics/Penetraatiotestaus/63.png" alt="" width="700" height=""/>
    <p>En kuitenkaan löytänyt sieltä heti silmiinpistävää kategoriaa, joka sisältäisi käyttäjänimet ja salasanat. Joten päätin katsoa ensimmäisen Community solution videon, jota Portswigger tarjosi, video varmaankin oli vanhalle tehtävälle, koska taulujen nimet eivät täsmänneet.</p>
<p>Katsoin  vastauksesta, että sieltä olisi pitänyt löytyä USERS_ABCDEF niminen taulu. Syötin alla olevan Zapin requesteriin.</p>
<p>'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_ABCDEF'—</p>
<img src="Graphics/Penetraatiotestaus/64.png" alt="" width="700" height=""/>
<p>Sain tällaisen vastauksen, joku ei nyt menny oikein.</p>
<img src="Graphics/Penetraatiotestaus/65.png" alt="" width="700" height=""/>
<p>Muokkasin komentoa USERS_EUVJOW muotoon, jonka löysin sivujen table listauksesta, joka oli tulostunut tuolla aikasemmassa vaiheessa. ja lähetin komennon. Tämä taulunimi siis poikkesi videon taulun nimestä.</p>
<img src="Graphics/Penetraatiotestaus/66.png" alt="" width="700" height=""/>
<p>Taas tällainen vastaus, mutta nyt katsoin sivun alas ja siellä oli:</p>
<img src="Graphics/Penetraatiotestaus/67.png" alt="" width="700" height=""/>
<p>PASSWORD_DJAGUI
    <br>
    USERNAME_SNFRGW
    <br>
    Näistä muodostin injektion: ’ UNION select USERNAME_SNFRGW, PASSWORD_DJAGUI from USERS_EUVJOW—
    </p>
    se toimi:
    <p>
        <img src="Graphics/Penetraatiotestaus/68.png" alt="" width="700" height=""/>

    </p>
    <p>Kirjauduin adminina sisään ja labra oli ratkaistu</p>
    <p>Jatkan tehtävien tekoa myöhemmin</p>
    <p>
        Lähteenä raportissa on käytetty <a href="https://terokarvinen.com/2023/eettinen-hakkerointi-2023/">Hacking 2023 - Tunkeutumistestaus ict4tn027-3012 loppusyksy online (terokarvinen.com)</a>
    </p>

</body>
</html>
